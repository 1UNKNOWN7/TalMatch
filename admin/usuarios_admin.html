<!DOCTYPE html>
<html lang="es">
<head>
  <!-- ===== Meta ===== -->
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
  <title>TalMatch – Gestión de Usuarios</title>

  <!-- ===== Estilos ===== -->
  <link rel="stylesheet" href="usuarios_admin.css"/>

  <!-- Fuente coherente -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
</head>
<body>
  <div class="page-wrap">
    <!-- ===== Header ===== -->
    <header class="tm-header">
      <div class="brand">
        <img src="/imagenes/talmach.jpg" alt="TalMatch" class="logo">
        <h1>Gestión de usuarios</h1>
      </div>
      <div class="header-actions">
        <a href="inicio_admin.html" class="btn btn-secondary">← Volver</a>
        <!-- Toggle dark mode -->
        <label class="theme-toggle">
          <input id="themeSwitch" type="checkbox" aria-label="Activar modo oscuro">
          <span class="slider"></span>
          <span class="theme-label">Modo oscuro</span>
        </label>
      </div>
    </header>

    <main class="tm-container">
      <!-- Toast -->
      <div id="toast" class="toast" role="status" aria-live="polite"></div>

      <!-- ===== Card principal ===== -->
      <section class="card">
        <h2>Usuarios registrados</h2>

        <!-- Toolbar: filtros y búsqueda -->
        <div class="toolbar">
          <div class="control">
            <label for="filtroRol">Rol</label>
            <select id="filtroRol">
              <option value="TODOS">Todos</option>
              <option value="CANDIDATO">Candidato</option>
              <option value="RECLUTADOR">Reclutador</option>
              <option value="ADMIN">Admin</option>
            </select>
          </div>

          <div class="control">
            <label for="filtroEstado">Estado</label>
            <select id="filtroEstado">
              <option value="TODOS">Todos</option>
              <option value="ACTIVO">Activo</option>
              <option value="SUSPENDIDO">Suspendido</option>
            </select>
          </div>

          <div class="control grow">
            <label for="busqueda">Buscar</label>
            <input id="busqueda" type="search" placeholder="Nombre, correo o ID...">
          </div>

          <div class="actions">
            <button id="btnDemo" class="btn btn-ghost" type="button">Cargar demo</button>
            <button id="btnReset" class="btn btn-ghost" type="button">Reiniciar</button>
          </div>
        </div>

        <!-- Tabla -->
        <div class="table-wrap">
          <table class="table">
            <thead>
              <tr>
                <th>Usuario</th>
                <th>Correo</th>
                <th>Rol</th>
                <th>Estado</th>
                <th class="col-acciones">Acciones</th>
              </tr>
            </thead>
            <tbody id="tbodyUsuarios">
              <!-- filas via JS -->
            </tbody>
          </table>
        </div>
      </section>
    </main>

    <footer class="tm-footer"><small>© TalMatch · Admin</small></footer>
  </div>

  <!-- ===== JS DEMO (sin backend) ===== -->
  <script>
    // ---- Storage keys
    const KEY_THEME = "talmatch_theme";
    const KEY_ADMIN_USERS = "talmatch_admin_users";

    // ---- Refs
    const themeSwitch = document.getElementById('themeSwitch');
    const toast = document.getElementById('toast');
    const filtroRol = document.getElementById('filtroRol');
    const filtroEstado = document.getElementById('filtroEstado');
    const busqueda = document.getElementById('busqueda');
    const btnDemo = document.getElementById('btnDemo');
    const btnReset = document.getElementById('btnReset');
    const tbody = document.getElementById('tbodyUsuarios');

    // ---- Tema
    (function initTheme(){
      const saved = localStorage.getItem(KEY_THEME) || "light";
      if (saved === "dark") { document.body.classList.add("dark"); themeSwitch.checked = true; }
      themeSwitch.addEventListener("change", ()=>{
        document.body.classList.toggle("dark", themeSwitch.checked);
        localStorage.setItem(KEY_THEME, themeSwitch.checked ? "dark" : "light");
      });
    })();

    // ---- Utils
    function toastMsg(msg,type="info"){ toast.textContent = msg; toast.className = `toast ${type} show`; setTimeout(()=>toast.classList.remove('show'),1800); }
    function save(data){ localStorage.setItem(KEY_ADMIN_USERS, JSON.stringify(data)); }
    function load(){ try{ return JSON.parse(localStorage.getItem(KEY_ADMIN_USERS) || "[]"); }catch{ return []; } }

    // ---- Seeds
    function demo(){
      return [
        { id:"U-0001", nombre:"Cecilia Méndez", correo:"cecilia.mendez@mail.com", rol:"CANDIDATO", estado:"ACTIVO" },
        { id:"U-0002", nombre:"Edgar Guzmán", correo:"edgar.guzman@mail.com", rol:"CANDIDATO", estado:"SUSPENDIDO" },
        { id:"U-0100", nombre:"RRHH TecnoMasaya", correo:"rrhh@tecnomasaya.com", rol:"RECLUTADOR", estado:"ACTIVO" },
        { id:"U-9999", nombre:"Admin TalMatch", correo:"admin@talmatch.com", rol:"ADMIN", estado:"ACTIVO" }
      ];
    }

    let usuarios = load();

    // ---- Render
    function render(){
      const role = filtroRol.value;
      const est = filtroEstado.value;
      const q = (busqueda.value||"").toLowerCase().trim();

      const data = usuarios.filter(u=>{
        const okRol = role==="TODOS" || u.rol===role;
        const okEst = est==="TODOS" || u.estado===est;
        const txt = (u.nombre+" "+u.correo+" "+u.id).toLowerCase();
        const okQ = q==="" || txt.includes(q);
        return okRol && okEst && okQ;
      });

      tbody.innerHTML = "";
      if(!data.length){
        tbody.innerHTML = `<tr><td class="empty" colspan="5">Sin resultados</td></tr>`;
        return;
      }
      for(const u of data){
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td data-label="Usuario"><strong>${u.nombre}</strong><div class="muted">ID: ${u.id}</div></td>
          <td data-label="Correo">${u.correo}</td>
          <td data-label="Rol"><span class="pill ${u.rol.toLowerCase()}">${u.rol}</span></td>
          <td data-label="Estado"><span class="pill ${u.estado.toLowerCase()}">${u.estado}</span></td>
          <td data-label="Acciones" class="acciones">
            <button class="btn btn-secondary" data-id="${u.id}" data-act="editar">Editar</button>
            <button class="btn ${u.estado==='ACTIVO'?'btn-ghost':'btn-primary'}" data-id="${u.id}" data-act="toggle">${u.estado==='ACTIVO'?'Suspender':'Activar'}</button>
            <button class="btn btn-ghost" data-id="${u.id}" data-act="eliminar">Eliminar</button>
            <a class="btn btn-secondary" href="vpusuario.html">Ver perfil</a>
          </td>`;
        tbody.appendChild(tr);
      }
    }

    // ---- Acciones
    document.addEventListener("click", (ev)=>{
      const btn = ev.target.closest("button");
      if(!btn) return;
      const id = btn.dataset.id;
      const act = btn.dataset.act;
      const u = usuarios.find(x=>x.id===id);
      if(!u) return;

      if(act==="editar"){
        const nuevoNombre = prompt("Editar nombre:", u.nombre);
        if(nuevoNombre && nuevoNombre.trim()){ u.nombre = nuevoNombre.trim(); save(usuarios); render(); toastMsg("Usuario actualizado","success"); }
      }
      if(act==="toggle"){
        u.estado = (u.estado==="ACTIVO") ? "SUSPENDIDO" : "ACTIVO";
        save(usuarios); render(); toastMsg(u.estado==="ACTIVO"?"Usuario activado":"Usuario suspendido","info");
      }
      if(act==="eliminar"){
        if(confirm("¿Eliminar usuario? Esta acción es irreversible.")){
          usuarios = usuarios.filter(x=>x.id!==id);
          save(usuarios); render(); toastMsg("Usuario eliminado","error");
        }
      }
    });

    // Filtros
    filtroRol.addEventListener("change", render);
    filtroEstado.addEventListener("change", render);
    busqueda.addEventListener("input", render);

    // Demo
    btnDemo.addEventListener("click", ()=>{ usuarios = demo(); save(usuarios); render(); toastMsg("Datos de demo cargados","success"); });
    btnReset.addEventListener("click", ()=>{ localStorage.removeItem(KEY_ADMIN_USERS); usuarios=[]; render(); toastMsg("Demo reiniciada","success"); });

    // Init
    render();
  </script>
</body>
</html>
